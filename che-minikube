#!/bin/sh

# shellcheck source=env.sh
. "$( dirname "${0}" )/env.sh"

if [ -z "${1}" ]; then
        MEMORY=6
else
        MEMORY=${1}
fi

set -x

minikube start --memory ${MEMORY}gb --disk-size 40g --vm-driver=kvm2 --extra-config=apiserver.authorization-mode=RBAC userland-proxy=false

kubectl create namespace che
kubectl create clusterrolebinding add-on-cluster-admin --clusterrole=cluster-admin --serviceaccount=kube-system:default
kubectl create serviceaccount tiller --namespace kube-system
kubectl apply -f "${CHEDIR}"/deploy/kubernetes/helm/che/tiller-rbac.yaml
helm init --service-account tiller --wait
minikube addons enable ingress
